---
title: Using The API & Advanced Server Management
slug: using-the-api
fullpath: /guides/using-the-api
---

---

# Table of Contents
- [# Updating Chapters](#updating-chapters) (And [# Repairing Chapters with Audacity](#audacity-chapter-workflow))
- [# Get Your Book Progresses](#get-your-book-progresses)
- [# Encode Books as M4B](#encode-book-as-m4b)
---

# Introduction

To use the API a few things are required. 
- The url to your current ABS instance and usually which library you wish to interact with. 
- An API Key which you can get from the Users page by **clicking on the User** not the edit button or via the [Login](https://api.audiobookshelf.org/#login) endpoint
![User Token](/guides/using_the_api/user.jpg)
- Command specific data in JSON form

> ℹ️ For any `GET` commands if you are logged into the server in a browser you can navigate to the api url for testing/small jobs

## The API Docs

While not automatically kept up to date the API Docs show most everything you can do with your ABS server. The current iteration of them can be found [here](https://api.audiobookshelf.org). If you wish to dig deeper, watch the network calls while navigating your ABS server from inside a browser (F12 > Network by default in many browsers).

When using the docs pay attention to the sections linked under the command of interest as they show exactly what ABS is expecting from more complex parameters.
![Example Parameters](/guides/using_the_api/example_parameters.jpg)


---
# Updating Chapters
Chapters can be batch updated via JSON, this is useful for books that are recombined from parts that have been split on seperated CDs or downloaded as parts and thus dont match up with the chapter data that might be available elsewhere.

> ⚠️ Be aware that this has to be ALL the chapters together since this endpoint overwrites whatever chapter data is currently there.

## Required Info
- **Item ID** - From the URL of the book in question <ins>your.ABS.intance/audiobookshelf/item/**dc385e6a-693b-4daa-823f-1f8f70c0c63a**</ins>
- **API Token** - From the Users page by **clicking on the User** not the edit button or via the [Login](https://api.audiobookshelf.org/#login) endpoint
- **Chapters** - The data in JSON Array format `-d "{\"chapters\": [{\"id\":0,\"start\":0,\"end\":150.296003,\"title\":\"Introduction\"}]}"`

## cURL Command
Windows CMD 
```cmd
curl http://localhost:13378/audiobookshelf/api/items/{bookID}/chapters ^
  -H "Authorization: Bearer user.api.token.here" ^
  -H "Content-Type: application/json" ^
  -d "{\"chapters\": [{\"id\":0,\"start\":0,\"end\":150.296003,\"title\":\"Introduction\"}]}"
```

Linux Bash
```bash
curl -X POST http://localhost:13378/audiobookshelf/api/items/{bookID}/chapters \
  -H "Authorization: Bearer user.api.token.here" \
  -H "Content-Type: application/json" \
  -d '{"chapters": [{"id":0,"start":0,"end":150.296003,"title":"Introduction"}]}'
```

---

# Audacity Chapter Workflow

Using audacity we can streamline the process of adding chapters to a book that has unusable/no chapter markers.
1. Use the audio label tool to auto detect chapters
    - Clean up extra or missing chapter markers
2. Export those labels and turn them into the format ABS expects from api calls
    - From TSV to an array of JSON objects
3. Post our data to the ABS server

> ℹ️ To navigate Labels use Alt+ArrowKeys to jump between them and Shift+Scroll to scroll audio left and right

## Label Chapters in Audacity
- Select a ~12h segment - Audacity cannot process more than 13.5h of 44khz audio at a time with the label tool.
- Analyze > Label Sounds
  ![Analyze Settings](/guides/using_the_api/audacity_analyze.jpg)
- A good place to start is `Minimum Silence: 3s` plus `Minimum Label Interval: 1s`
  - You might have to play with the settings a little based on how slow the narrators speak or how tightly the editting is done
  - You can highlight the silence before a chapter marker to get a guess of how long of a silence you need
  - Change the Label Text to `Chapter ##1` to automatically name the chapters and avoid having to rename them later
- If a chapter is missing select the overly long section by clicking the label for it
  - Right Click the Label > Delete Label
  - Reanalyze the highlighted section with more forgiving settings 2.5 or lower works well to split chapters
  - Clean up labels
- Edit > Labels > Edit Labels > Export

### Alternatively Edit Preexisting Chapters
If you have access to the metadata files, use [the item endpoint](https://api.audiobookshelf.org/#get-a-library-item), or just change `/audiobookshelf/item/8d1ce4...` to /audiobookshelf`/api`/item`s`/8d1ce4... in your browser you can get the chapter data that ABS already has so you can clean it up yourself. Audacity expects TSV data in the form of `start  end title` in a text file. You can convert the ABS json to TSV using [this site](https://codebeautify.org/json-to-tsv-converter) or your favorite tool.
- Chapters can be imported as label data
  - Edit > Labels > Edit Labels...
  - Import > Select your .txt file and ignore the warning if you didnt string the id column out, its fine
    ![Example Labels](/guides/using_the_api/labels.jpg)
  - Drag the circles between chapter markers to place the end/beginnings in the correct place
  - Edit > Labels > Edit Lables > Export

## Add missing ID column to TSV
First we need to add the chapter ids to our exported data
- Paste labels into a spreadsheet and add column headers and an id column starting at 0
  - Alternately you can do this in a feature rich text editor/automate if you prefer
- Export as TSV or CSV
- Ensure column headers are [`id,start,end,title`]
    ![Example Labels](/guides/using_the_api/TSV.jpg)
You can also use your text editor of choice if it has the tools necessary, just remember to add the column headers before converting to JSON


## Convert TSV to JSON
- [This](https://csvjson.com/csv2json) converter is convenient and also is a cli tool if that fits your workflow better.
- Also available as an npm package https://www.npmjs.com/package/csvjson-csv2json
- Output: Array > Minify   Make sure these settings are selected so things don't interfere with cURL later 
    ![Converter Settings](/guides/using_the_api/converter_settings.jpg)

## cURL command to update chapters
This is where we use the api key from earlier along with our book's item id
- JSON payload must be {chapters: [array of chapter objects]}
- For windows the json payload needs to have its `"`s escapted as `\"` since cmd doesn't like single quotes
- Dont forget to close the payload object after pasting in the converted json array

Windows CMD 
```cmd
curl http://localhost:13378/audiobookshelf/api/items/{bookID}/chapters ^
  -H "Authorization: Bearer user.api.token.here" ^
  -H "Content-Type: application/json" ^
  -d "{\"chapters\": [that big json array]}"
```

Linux Bash
```bash
curl -X POST http://localhost:13378/audiobookshelf/api/items/{bookID}/chapters \
  -H "Authorization: Bearer user.api.token.here" \
  -H "Content-Type: application/json" \
  -d '{"chapters": [that big json array]}'
```

---
# Get Your Book Progresses

## Required Info
- **API Token** - From the Users page by **clicking on the User** not the edit button or via the [Login](https://api.audiobookshelf.org/#login) endpoint
- **User ID** - From user page URL <ins>/audiobookshelf/config/users/**47a2c8c7-0404-4365-bb83-fb14e2b00744**</ins>

> ℹ️ The `/api/users/userID` endpoint requires an admin API key but the `/api/me` endpoint does not

## Pulling your data
Either use the [user endpoint](https://api.audiobookshelf.org/#get-a-user) or navigate to in a browser to `/audiobookshelf/api/users/{userID}`. Alternatively if you are interested in your own data you can use the `/audiobookshelf/api/me` [endpoint](https://api.audiobookshelf.org/#get-your-user) or url.

Each book the user has read has a corresponding mediaProgress object:
```json
{
  "id": "c1413395-a9a6-4632-9556-01fb2czca400",             //The ID of the Progress Record internally
  "userId": "9be14cdb-22zz-4445-9191-d1h54523529708",       //The ID of the User
  "libraryItemId": "9141ba3a-ce32-5bdd-9432-4d6af425160d",  //The ID of the Book used in URLs
  "episodeId": null,                                        //The ID of the Podcast Episode if podcast
  "mediaItemId": "b3enbaf6-fvb0-4v7c-bfsb-29rw51364a68",    //The ID of the internal book/podcast media
  "mediaItemType": "book",                                  //Is it a book or podcastEpisode
  "duration": 77192.973333,                                 //How long the book is
  "progress": 1,                                            //How far the user got as a fraction (0-1)
  "currentTime": 77192.978,                                 //Where the user ended
  "isFinished": true,                                       //Was it auto or manually Mark as Finished
  "hideFromContinueListening": false,                       //Did the user hide this item on the homepage
  "ebookLocation": "epubcfi(/6/18!/4/2/278/1:0)",           //Ebook style progress location
  "ebookProgress": 0.2397,                                  //Ebook progress as a fraction (0-1)
  "lastUpdate": 1735409116524,                              //Unix Epoch timestamp 
  "startedAt": 1734152810867,                               //Unix Epoch timestamp 
  "finishedAt": 1735409116524,                              //Unix Epoch timestamp 
  "displayTitle": "The Black Prism",                        //Book/Podcast Episode Title
  "displaySubtitle": "Only used for Podcasts",              //Podcast Name
  "coverPath": "T:/he/path_to/your_cover_art.jpg",          //Filesystem path to cover art
  "mediaUpdatedAt": "2022-05-11T01:51:17.931Z"              //
}
```

Depending on your usecase the most interesting data points are:
- `libraryItemId` - If you need more specific info about the book in question ie. ASIN or ISBN
- `isFinished`    - If you're syncing progress with another service use these
- `progress`      - If you're syncing progress with another service use these
- `ebookProgress` - If you're syncing progress with another service use these
- `lastUpdate` - The last time the user read this book
- `startedAt` - Nice for tracking your reading habits
- `finishedAt` - Nice for tracking your reading habits
- `displayTitle` - The title of the book  (User endpoint only)


> ℹ️ If you need more data points for matching books in other services try checking `/audiobookshelf/api/items/{itemID}/metadata-object` before pulling the whole library item entry.

> ⚠️ Up to <ins>v2.24.0</ins> the `/api/me` endpoint does not return the `displayTitle` or `displaySubtitle`. Use the `/api/users/{userID}` endpoint if this is all you need or look up `libraryItemId` seperately from the `/api/items/{itemID}` [endpoint](https://api.audiobookshelf.org/#get-a-library-item) or above metadata endpoint.

---
# Encode Book as M4B
This tool is accessable from Edit > Tools page for each book but [this endpoint](https://api.audiobookshelf.org/#encode-a-book-as-m4b) allows automation

## Required Info
- **API Token** - From the Users page by **clicking on the User** not the edit button or via the [Login](https://api.audiobookshelf.org/#login) endpoint
- **Item ID** - From item page URL <ins>/audiobookshelf/item/**e81d2966-a948-4ecd-a3e4-d262492cf51d**</ins>

## Things to know
> ℹ️ This command requires an admin API key

When choosing the bitrate/codec/channel count for this command its useful to know what the current audio files stats are. Using the [library item endpoint](https://api.audiobookshelf.org/#get-a-library-item) or changing `/audiobookshelf/item/e8ba45c0-9d34-4e7a-8f5b-439e41eca731` to /audiobookshelf/`api/`item`s`/e8ba45c0-9d34-4e7a-8f5b-439e41eca731 you can inspect the `audioFiles > bitRate/codec/channels`

As far as codecs go most of the time you can just use the `copy` setting to avoid transcoding the audio unless you want specifically to change it. People have reported issues with playing M4B files that still have an mp3 audio codec in other programs especially ones that assume it will be handling an `aac` codec. In such cases you can reuse the command with a new codec (`acc` or `opus` lowercase)

Multiple commands can be queued up at the same time letting you scan through your library and start encodes for all necessary books in one go

> ⚠️ Be aware that these commands move the old audio files to the metadata/cache/items folder and must be cleared out periodically. Use [this](https://api.audiobookshelf.org/#purge-items-cache) endpoint or if convenient delete the local files.

## cURL Command
Encode Command

```cmd
curl -X POST "http://localhost:13378/audiobookshelf/api/tools/item/{itemID}/encode-m4b?bitrate=64k&codec=copy&channels=2" ^
  -H "Authorization: Bearer your.api.key.here" 
```

```bash
curl -X POST "http://localhost:13378/audiobookshelf/api/tools/item/{itemID}/encode-m4b?bitrate=64k&codec=copy&channels=2" \
  -H "Authorization: Bearer your.api.key.here" 
```

Stop command - This cancles the encode job for this book

```cmd
curl -X DELETE "http://localhost:13378/audiobookshelf/api/tools/item/{itemID}/encode-m4b" ^
  -H "Authorization: Bearer your.api.key.here" 
```

```bash
curl -X DELETE "http://localhost:13378/audiobookshelf/api/tools/item/{itemID}/encode-m4b" \
  -H "Authorization: Bearer your.api.key.here" 
```
