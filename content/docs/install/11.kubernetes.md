# Audiobookshelf Deployment in Kubernetes

## Prerequisites

1. **Kubernetes Cluster**
   Ensure you have a Kubernetes cluster running. This deployment assumes you're using **nginx** as the ingress controller.

2. **Ingress Controller (NGINX)**
   Make sure NGINX ingress controller is installed and configured on your cluster. If you don't have it installed yet, you can follow the [official NGINX ingress controller installation guide](https://kubernetes.github.io/ingress-nginx/deploy/).

3. **Cluster Issuer for Let's Encrypt**
   You need a **ClusterIssuer** to automatically manage TLS certificates using Let's Encrypt. Below is an example configuration to create a ClusterIssuer:

   ```yaml
   apiVersion: cert-manager.io/v1
   kind: ClusterIssuer
   metadata:
     name: letsencrypt-production
   spec:
     acme:
       server: https://acme-v02.api.letsencrypt.org/directory
       email: your-email@example.com  # Replace with your email
       privateKeySecretRef:
         name: letsencrypt-production-key
       solvers:
       - http01:
           ingress:
             class: nginx

* Replace your-email@example.com with your own email address.
* This will use HTTP-01 challenge for certificate issuance, with NGINX managing the ingress.

Apply this YAML to your cluster using:

```bash
kubectl apply -f cluster-issuer.yaml
```
4. **Subdomain Setup (Optional)** If you want to use a subdomain, set up your DNS records to point to your Kubernetes cluster. In this case, I am using OVH as my DNS provider. Create an A record for your subdomain pointing to your clusterâ€™s IP address.

## Create Namespace for Audiobookshelf
First, create a dedicated namespace for Audiobookshelf:
```yaml
apiversion: v1kind: Namespacemetadata:  name: audiobookshelf-ns
```
Apply the namespace with:
```bash
kubectl apply -f namespace.yaml
```
## Audiobookshelf Kubernetes Deployment
### 1. Audiobookshelf Service
Defines a service that exposes the Audiobookshelf application within the cluster:
```yaml
apiVersion: v1
kind: Service
metadata:
  name: audiobookshelf
  namespace: audiobookshelf-ns
spec:
  selector:
    app: audiobookshelf  # Matches the label from the Deployment
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
  type: ClusterIP  # Exposes the service only inside the cluster
```
